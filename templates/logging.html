{% extends 'layout.html' %}
{% block extraheaders %}
<style type="text/css">
a.balloon {
    text-decoration: none;
}
.balloon .popup {
    display: none;
    border-collapse: collapse;
    position: absolute;
    margin-top: -0.5em;
    width: 26em;
    background-color: white;
    border: 1px solid #333;
    box-shadow: 2px 2px 0 0 #555;
}
.balloon:hover .popup {
    display: block;
}
.prev {
    float: left;
}
.next {
    float: right;
}
#map-canvas {
    margin-top: 1em;
    height: 22em;
    width: 40em;
}
.eventlog {
    margin-bottom: 1em;
    width: 15em;
}
.eventlog td {
    width: 50%;
}
.leftcol {
    width: 60%;
    float: left;
    font-size: 0.9em;
}
.rightcol {
    width: 40%;
    float: left;
    font-size: 0.9em;
}
a.back {
    float: right;
    color: blue;
    text-decoration: underline;
    font-size: 0.9em;
}
#detail > h2 {
    margin-bottom: 1em;
}
.logtotals{
    background-color: #CCCCCC;
    font-weight: bold;
}
.logtotals .total {
    text-align: right;
}
</style>
{% endblock %}

{% block content %}
<nav id="datesel">
    <ul></ul>
</nav>
  <div id="logging" class="loading">
      <h2 class="loading">Loading logging data...</h2>
<table id="summary" class="table table-striped table-bordered table-condensed">
<thead>
<tr>
<th class="devicetype" rowspan="2">Type</th>
<th class="uid clickable" rowspan="2">UID</th>
<th class="location" rowspan="2">Location</th>
<th class="date clickable" rowspan="2">Date</th><th colspan="4">Number of samples</th>
<th colspan="3">Average duration</th></tr>
<tr class="odd">
<th>Total</th>
<th><img src="/img/globe.png" alt="Cloud" title="Cloud" /></th>
<th><img src="/img/bonjour.png" alt="ZeroConf" title="ZeroConf" /></th>
<th><img src="/img/upnp.png" alt="UPnP" title="UPnP" /></th>
<th><img src="/img/globe.png" alt="Cloud" title="Cloud" /></th>
<th><img src="/img/bonjour.png" alt="ZeroConf" title="ZeroConf" /></th>
<th><img src="/img/upnp.png" alt="UPnP" title="UPnP" /></th></tr></thead>
<tbody>
</tbody>
<tfoot>
</tfoot>
</table>
  </div>
{% endblock %}

{% block scripts %}
{% raw %}
<script type="text/template" id="event-row">
        <td data-title="'Name'" sortable="name" class="devicetype <%= client?'client':'device' %>">
            <% if(client){ %>
            <img src="/img/smart_phone_simple.png" alt="client" title="Client results" />
            <% } else { %>
            <img src="/img/radio_silhouette.png" alt="device" title="Device results" />
            <% } %>
        </td>
        <td class="uid clickable" data-title="'UID'" ><p><%-uid%></p></td>
        <td class="location" data-title="'Location'"><%-city%> (<%-addr%>)</td>
        <td class="date clickable" data-title="'Date'" sortable="date"><%= date.format("DD MMMM YYYY") %></td>
        <td class="count"><%=totalCount%></td>
        <td class="count <%= (cloudCount<totalCount)?'failures':'' %>"><%-cloudCount%></td>
        <td class="count <%= (zeroconfCount<totalCount)?'failures':'' %>"><%-zeroconfCount%></td>
        <td class="count <%= (upnpCount<totalCount)?'failures':'' %>"><%-upnpCount%></td>
        <td class="time"><%-model.cloudDuration()%></td>
        <td class="time"><%-model.zeroconfDuration()%></td>
        <td class="time"><%-model.upnpDuration()%></td>
</script>

<script type="text/template" id="event-foot">
    <tr class="logtotals">
        <td colspan="4" class="total">Total</td>
        <td class="count"><%= totalCount %></td>
        <td class="count <%= (cloudCount<totalCount)?'failures':'' %>"><%= cloudCount %></td>
        <td class="count <%= (zeroconfCount<totalCount)?'failures':'' %>"><%= zeroconfCount %></td>
        <td class="count <%= (upnpCount<totalCount)?'failures':'' %>"><%= upnpCount %></td>
        <td class="time"><%- cloudDuration %></td>
        <td class="time"><%- zeroconfDuration %></td>
        <td class="time"><%- upnpDuration %></td>
    </tr>
</script>

<script type="text/template" id="event-detail">
    <span class="back link">Back to summary</span>
    <table>
        <tr><td>Date</td><td>{{date}}</td></tr>
{{#if name }}<tr><td>Friendly name</td><td>{{name}}</td></tr>{{/if}}
<tr><td>UID</td><td class="uid clickable">{{uid}}</td></tr>
<tr><td>Public IP address</td><td class="ipaddress">{{addr}}</td></tr>
<tr><td>Location</td><td class="location">{{city}}</td></tr>
<tr><td>Lat,long</td><td class="location">{{loc.lat}}, {{loc.lon}}</td></tr>
{{#if extra }}
{{#if extra.dhcp }}
{{#key_value extra.dhcp}}
<tr><td>DHCP {{key}}</td><td class="extra">{{value}}</td></tr>
{{/key_value}}
{{/if}}
{{#if extra.wifi }}
{{#key_value extra.wifi}}
<tr><td>WiFi {{key}}</td><td class="extra">{{value}}</td></tr>
{{/key_value}}
{{/if}}
{{/if}}
</table>
</script>

{% endraw %}
  <script type="text/javascript" src="/js/dev/jquery-1.10.2.js"></script>
  <script type="text/javascript" src="/js/dev/underscore.js"></script>
  <script type="text/javascript" src="/js/dev/backbone.js"></script>
  <script type="text/javascript" src="/js/dev/moment.js"></script>
  <script type="text/javascript" src="/js/models.js"></script>
  <script type="text/javascript" src="/js/views.js"></script>
  <script type="text/javascript" src="/js/routes.js"></script>
<script type="text/javascript">
{% if not on_production_server %}
{% endif %}
  $(document).ready(function() {
    App.appView = new App.AppView();
    App.dateSelectView = new App.DateSelectView();
  });
</script>
<script type="text/javascript" src="/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="/js/logging.js"></script>
{% endblock %}